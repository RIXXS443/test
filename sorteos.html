<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Sorteo</title>
<style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 90%; /* Responsive width */
    }

    h1 {
      text-align: center;
      color: #007bff;
      font-size: 2rem; /* Ajuste de tamaño para pantallas pequeñas */
    }

    .sorteo-info, .form-group {
      margin-bottom: 20px;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      font-size: 1rem; /* Ajuste de tamaño de fuente */
    }

    input[type="text"] {
      padding: 8px;
      width: calc(100% - 20px); /* Ajuste responsive */
      margin: 0 auto;
      border: 1px solid #ddd;
      border-radius: 4px;
      max-width: 250px; /* Máximo ancho */
    }

    .number-selection {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    .number-selection input[type="checkbox"] {
      display: none;
    }

    .number-selection label {
      display: inline-block;
      margin: 5px;
      font-size: 1.1rem;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      position: relative;
      transition: all 0.3s ease;
      cursor: pointer;
      min-width: 40px; /* Mínimo ancho para móviles */
      text-align: center;
    }

    .number-selection input[type="checkbox"]:disabled + label {
      background-color: #eee;
      color: #999;
      cursor: not-allowed;
      position: relative;
    }

    .number-selection input[type="checkbox"]:disabled + label::before {
      content: 'X';
      font-size: 20px;
      color: #d9534f;
      position: absolute;
      top: 0;
      right: 0;
      transform: translate(50%, -50%);
    }

    .number-selection input[type="checkbox"]:checked + label {
      background-color: #007bff;
      color: white;
      border: 1px solid #007bff;
      transform: scale(1.1);
    }

    button {
      padding: 10px 20px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
      font-size: 1rem; /* Ajuste de tamaño de fuente */
    }

    button:hover {
      background-color: #0056b3;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    /* Media Queries para hacer que la página sea responsive */
    @media (max-width: 768px) {
      .number-selection {
        gap: 5px; /* Espacio más pequeño entre los elementos */
      }

      .number-selection label {
        font-size: 1rem; /* Tamaño de fuente reducido */
        padding: 8px 12px; /* Padding ajustado */
      }

      table th, table td {
        font-size: 0.9rem; /* Reducir tamaño de fuente */
        padding: 8px; /* Ajustar padding */
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.5rem; /* Reducir tamaño de fuente para móviles */
      }

      .number-selection label {
        font-size: 0.9rem; /* Tamaño de fuente más pequeño */
        padding: 5px 10px; /* Padding más pequeño */
      }

      button {
        width: 100%; /* Botón toma el 100% del ancho en móviles */
        padding: 12px; /* Ajustar padding del botón */
      }

      input[type="text"] {
        width: 100%; /* Ajustar ancho de los campos de texto */
        max-width: none; /* Eliminar máximo ancho en móviles */
      }
    }
  </style>
</head>
<body>
  <h1>Registro de Sorteo</h1>

  <div class="container">
    <div class="sorteo-info">
      <label for="sorteo-name">Nombre del Sorteo:</label>
      <input type="text" id="sorteo-name" required>
    </div>

    <!-- Selección de números de forma visual -->
    <div class="number-selection">
      <!-- Números visuales -->
      <input type="checkbox" id="checkbox-1" value="1">
      <label for="checkbox-1">1</label>

      <input type="checkbox" id="checkbox-2" value="2">
      <label for="checkbox-2">2</label>

      <input type="checkbox" id="checkbox-3" value="3">
      <label for="checkbox-3">3</label>

      <input type="checkbox" id="checkbox-4" value="4">
      <label for="checkbox-4">4</label>

      <input type="checkbox" id="checkbox-5" value="5">
      <label for="checkbox-5">5</label>

      <input type="checkbox" id="checkbox-6" value="6">
      <label for="checkbox-6">6</label>

      <input type="checkbox" id="checkbox-7" value="7">
      <label for="checkbox-7">7</label>

      <input type="checkbox" id="checkbox-8" value="8">
      <label for="checkbox-8">8</label>

      <input type="checkbox" id="checkbox-9" value="9">
      <label for="checkbox-9">9</label>

      <input type="checkbox" id="checkbox-10" value="10">
      <label for="checkbox-10">10</label>
    </div>

    <table id="sorteo-table">
      <thead>
        <tr>
          <th>Número</th>
          <th>Nombre</th>
          <th>Sorteo</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="form-group">
      <label for="participant-name">Nombre del Participante:</label>
      <input type="text" id="participant-name" required>
      <button id="add-participant">Agregar Participante</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const sorteoNameInput = document.getElementById('sorteo-name');
      const addParticipantButton = document.getElementById('add-participant');
      const sorteoTableBody = document.querySelector('#sorteo-table tbody');
      const participantNameInput = document.getElementById('participant-name');
      const numberCheckboxes = document.querySelectorAll('.number-selection input[type="checkbox"]');
      const registeredNumbers = new Set(); // Set para almacenar números registrados

      // Obtener números registrados al cargar la página
      obtenerNumerosRegistrados();

      addParticipantButton.addEventListener('click', function () {
        const sorteoName = sorteoNameInput.value.trim();
        const participantName = participantNameInput.value.trim();

        // Obtener números seleccionados
        const selectedNumbers = Array.from(numberCheckboxes)
          .filter(checkbox => checkbox.checked)
          .map(checkbox => checkbox.value);

        // Validaciones
        if (!sorteoName || selectedNumbers.length === 0 || !participantName) {
          alert("Por favor, completa todos los campos y selecciona al menos un número.");
          return;
        }

        // Agregar participante y números al sorteo
        selectedNumbers.forEach(function (number) {
          // Verificar si el número ya está registrado
          if (!registeredNumbers.has(number)) {
            const row = document.createElement('tr');
            const numberCell = document.createElement('td');
            const nameCell = document.createElement('td');
            const sorteoCell = document.createElement('td');
            const actionCell = document.createElement('td'); // Celda para las acciones

            numberCell.textContent = number;
            nameCell.textContent = participantName;
            sorteoCell.textContent = sorteoName;

            // Crear botón de eliminar
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Eliminar';
            deleteButton.addEventListener('click', function () {
              eliminarParticipante(sorteoName, number, participantName, row);
            });

            // Crear botón de editar
            const editButton = document.createElement('button');
            editButton.textContent = 'Editar';
            editButton.addEventListener('click', function () {
              editarParticipante(sorteoName, number, participantName);
            });

            // Crear botón de nuevo
            const nuevoButton = document.createElement('button');
            nuevoButton.textContent = 'Nuevo';
            nuevoButton.addEventListener('click', function () {
              guardarParticipanteEnBaseDeDatos(sorteoName, number, participantName);
            });

            actionCell.appendChild(deleteButton);
            actionCell.appendChild(editButton);
            actionCell.appendChild(nuevoButton);

            row.appendChild(numberCell);
            row.appendChild(nameCell);
            row.appendChild(sorteoCell);
            row.appendChild(actionCell); // Añadir la celda de acción a la fila
            sorteoTableBody.appendChild(row);

            // Llamada al API para guardar en la base de datos
            guardarParticipanteEnBaseDeDatos(sorteoName, number, participantName);
          } else {
            alert(`El número ${number} ya está registrado.`);
          }
        });

        // Limpiar selección de números después de agregar participante
        numberCheckboxes.forEach(checkbox => {
          if (checkbox.checked) {
            checkbox.disabled = true;
            registeredNumbers.add(checkbox.value); // Añadir número al Set de registrados
          }
          checkbox.checked = false;
        });
      });

      // Función para obtener números registrados desde la base de datos
      function obtenerNumerosRegistrados() {
        const url = 'https://prod-16.brazilsouth.logic.azure.com/workflows/afdbdf82d461481c8e6c1381ba764ba3/triggers/manual/paths/invoke/ver_numeros_registrados?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=rZrcKGoNxMeFgqCJ6pzxHYN7GDEvJ6amMeKAKjF3Aj4';

        fetch(url)
          .then(response => response.json())
          .then(data => {
            data.forEach(function (registro) {
              registeredNumbers.add(registro.Numero); // Añadir número al Set de registrados

              // Deshabilitar los checkboxes correspondientes
              const checkbox = document.querySelector(`.number-selection input[value="${registro.Numero}"]`);
              if (checkbox) {
                checkbox.disabled = true;
              }

              // Agregar los registros a la tabla
              const row = document.createElement('tr');
              const numberCell = document.createElement('td');
              const nameCell = document.createElement('td');
              const sorteoCell = document.createElement('td');
              const actionCell = document.createElement('td'); // Nueva celda para el botón de eliminar

              numberCell.textContent = registro.Numero;
              nameCell.textContent = registro["Nombre y Apellido"];
              sorteoCell.textContent = registro.Sorteo;

              // Crear el botón de eliminar
              const deleteButton = document.createElement('button');
              deleteButton.textContent = 'Eliminar';
              deleteButton.addEventListener('click', function () {
                eliminarParticipante(registro.Sorteo, registro.Numero, registro["Nombre y Apellido"], row);
              });

              actionCell.appendChild(deleteButton);

              row.appendChild(numberCell);
              row.appendChild(nameCell);
              row.appendChild(sorteoCell);
              row.appendChild(actionCell); // Añadir la celda de acción a la fila

              sorteoTableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error al obtener los números registrados:', error);
          });
      }

      // Función para guardar participante en la base de datos
      function guardarParticipanteEnBaseDeDatos(sorteo, numero, nombre) {
        const urlCrear = 'https://prod-02.brazilsouth.logic.azure.com/workflows/e0216dc0080c434f92f90ffda79fd4ff/triggers/manual/paths/invoke/actualizar_participante?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=lWqG4wSkg3jW3VK7Sl-5oRVdUsijaLZ3BzovP6e86ZA';
        const urlActualizar = 'https://prod-05.brazilsouth.logic.azure.com/workflows/1b22dc96da714da1a10b6ed483c76a90/triggers/manual/paths/invoke/crear_participante?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=dikB4VCLsvBfEUyXgJ7Q1wyF0O1Onpwa9GsJdH8YzdU';

        const data = {
          Numero: numero.toString(),
          Nombre: nombre,
          Sorteo: sorteo
        };

        // Crear en base de datos
        fetch(urlCrear, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
          console.log('Participante creado:', data);
        })
        .catch(error => {
          console.error('Error al crear participante:', error);
        });

        // Actualizar participante
        fetch(urlActualizar, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
          console.log('Participante actualizado:', data);
        })
        .catch(error => {
          console.error('Error al actualizar participante:', error);
        });
      }

      // Función para editar participante
      function editarParticipante(sorteo, numero, nombre) {
        const nuevoNombre = prompt('Ingresa el nuevo nombre del participante:', nombre);
        if (nuevoNombre && nuevoNombre.trim()) {
          guardarParticipanteEnBaseDeDatos(sorteo, numero, nuevoNombre);
        }
      }

      // Función para eliminar participante
      function eliminarParticipante(sorteo, numero, nombre, row) {
        const url = 'https://prod-16.brazilsouth.logic.azure.com/workflows/afdbdf82d461481c8e6c1381ba764ba3/triggers/manual/paths/invoke/eliminar_participante?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=jn1ys-p_-efu_bwm0D-AJIBS2gOkiGqKTVWUW45pesQ';

        const data = {
          Numero: numero.toString(),
          Nombre: nombre,
          Sorteo: sorteo
        };

        fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
          console.log('Participante eliminado:', data);
          // Eliminar la fila de la tabla
          row.remove();
          // Remover el número del Set de números registrados
          registeredNumbers.delete(numero);
          // Habilitar nuevamente el checkbox
          const checkbox = document.querySelector(`.number-selection input[value="${numero}"]`);
          if (checkbox) {
            checkbox.disabled = false;
          }
        })
        .catch(error => {
          console.error('Error al eliminar participante:', error);
        });
      }
    });
  </script>
</body>
</html>
